<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous">
</script>

<h2>Node tester</h2>
Userid: <input type='text' id='userid' value='mika' size='20'>
<p>
Number of concurrent calls: <input type='text' id='count' value='3' size='2'>
<p>
<div id='result'>Starting up ...</div>
<p>
<a href="/exit">Exit</a> server process ..

<script type="text/javascript">
  $('#userid').val($.now());
  function doEndlessly() {
    var done = $('#count').val(); // number of total simultaneos requests
    var userid = $('#userid').val();
    var res = '';
    setTimeout(function () {
      for(var i=0; i < done; i++) {
        $.getJSON('/inc?userid=' + userid, function(data) {
          res += data.i + ' <br>';
          console.log(data.useSessions);
          console.log(data.userid);
          done -= 1;
          if(done == 0) { // All reuests done, print out the results
            $('#result').html(res);
            doEndlessly();
          }
        }).fail(function() {
          doEndlessly();
        })
      }
    }, 3000);
  }

  doEndlessly();
</script>
